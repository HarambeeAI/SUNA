# Progress Log

## Learnings
(Patterns discovered during implementation)

- Database uses Basejump for account management (basejump.accounts, basejump.account_user)
- Migrations are SQL files in backend/supabase/migrations/ with timestamp naming (YYYYMMDDHHMMSS_description.sql)
- Use BEGIN/COMMIT for transactional migrations
- RLS policies use basejump.has_role_on_account() for permission checks
- TypeScript types defined in apps/mobile/api/types.ts and individual files in apps/frontend/src/lib/api/
- pnpm is required but not installed - use `npx pnpm install` to install deps, then `npx pnpm run lint`
- organization_role enum extends basejump's basic owner/member with: owner, admin, member, viewer
- Use public.has_org_role() and public.has_org_permission() for organization-level permission checks
- organization_members table tracks membership with additional metadata beyond basejump.account_user

---

## Iteration 1 - US-001: Add organizations table (first AC)
- What was implemented:
  - Created SQL migration 20260116215926_organizations_table.sql
  - Added organizations table with fields: id, name, slug, plan_tier, billing_status, account_id, stripe_customer_id, stripe_subscription_id, settings, created_at, updated_at
  - Created plan_tier enum (free, pro, enterprise)
  - Created billing_status enum (active, past_due, canceled, trialing, unpaid)
  - Added RLS policies for CRUD operations
  - Added helper functions: create_organization, get_organization, get_organization_by_slug, get_user_organizations
  - Added TypeScript types to apps/mobile/api/types.ts
  - Created apps/frontend/src/lib/api/organizations.ts with types and API functions
- Files changed:
  - backend/supabase/migrations/20260116215926_organizations_table.sql (new)
  - apps/mobile/api/types.ts (modified - added Organization types)
  - apps/frontend/src/lib/api/organizations.ts (new)
- Learnings for future iterations:
  - Organizations table links to basejump.accounts via account_id FK
  - Basejump already has billing_subscriptions table - organizations extends this with plan_tier
  - RLS patterns: use basejump.has_role_on_account() with optional role parameter
---

## Iteration 2 - US-001: Add organization_members table (second AC)
- What was implemented:
  - Created SQL migration 20260116220000_organization_members_table.sql
  - Added organization_members table with fields: id, org_id, user_id, role, invited_by, joined_at, metadata
  - Created organization_role enum (owner, admin, member, viewer) for granular RBAC
  - Added RLS policies for CRUD operations with role-based restrictions
  - Added helper functions: has_org_role, has_org_permission, get_org_role, add_org_member, get_org_members, update_org_member_role, remove_org_member
  - Updated create_organization to also add creator as owner in organization_members
  - Added TypeScript types: OrganizationRole, OrganizationMember, AddOrganizationMemberRequest, UpdateOrganizationMemberRoleRequest
  - Added API functions: getOrganizationMembers, addOrganizationMember, updateOrganizationMemberRole, removeOrganizationMember
- Files changed:
  - backend/supabase/migrations/20260116220000_organization_members_table.sql (new)
  - apps/mobile/api/types.ts (modified - added OrganizationMember types)
  - apps/frontend/src/lib/api/organizations.ts (modified - added member management types and API functions)
  - PRD.md (marked second AC as complete)
- Learnings for future iterations:
  - organization_members provides more granular roles than basejump's basic owner/member
  - Use has_org_permission() for hierarchical permission checks (owner > admin > member > viewer)
  - Self-removal (leave org) is allowed except for last owner
  - Admins can manage members/viewers but not owners/other admins
---
